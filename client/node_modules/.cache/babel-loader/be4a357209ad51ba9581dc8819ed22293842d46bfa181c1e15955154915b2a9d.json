{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{Box,Text,Image,Button}from\"@chakra-ui/react\";import{useNavigate}from\"react-router-dom\";import{useLoading}from\"../contexts/LoadingContext\";//import { useWallet } from \"../contexts/WalletContext\"; // Use wallet context for minting\nimport theme from\"../theme\";import axios from\"axios\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Register=()=>{const[selectedText,setSelectedText]=useState(\"\");// State to track selected text\nconst[buttonEnabled,setButtonEnabled]=useState(false);// State to track button enable/disable\nconst{setIsLoading}=useLoading();// Hook to trigger loading\n// const { mintNFT } = useWallet(); // Get the mintNFT function from WalletContext\nconst navigate=useNavigate();// Hook for navigation\nconst PINATA_JWT=process.env.REACT_APP_PINATA_JWT;// Function to handle text selection in the browser\nconst handleTextSelection=()=>{var _window$getSelection;const selectedText=((_window$getSelection=window.getSelection())===null||_window$getSelection===void 0?void 0:_window$getSelection.toString())||\"\";setSelectedText(selectedText);setButtonEnabled(selectedText.length>0);// Enable button if text is selected\n};// Listen for text selection in the window\nuseEffect(()=>{document.addEventListener(\"mouseup\",handleTextSelection);// Cleanup event listener when component unmounts\nreturn()=>{document.removeEventListener(\"mouseup\",handleTextSelection);};},[]);// const handleMint = async () => {\n//   if (selectedText) {\n//     setIsLoading(true); // Start loading\n//     try {\n//       // Step 1: Upload the selected text to IPFS\n//       const contentID = await uploadToIPFS(selectedText);\n//       if (contentID) {\n//         console.log(\"IPFS content ID:\", contentID);\n//         // Step 2: Send a request to your server's minting endpoint\n//         const response = await fetch(\"http://localhost:3000/api/mint\", {\n//           method: \"POST\",\n//           headers: {\n//             \"Content-Type\": \"application/json\",\n//           },\n//           body: JSON.stringify({\n//             userWalletAddress: process.env.REACT_APP_USER_PUBLIC_KEY, // Replace with recipient wallet address\n//             metadataURI: contentID, // Use the contentID from IPFS\n//             tokenName: \"YourTokenName\", // Hardcode or dynamically generate\n//             tokenLabel: \"YourTokenLabel\", // Hardcode or dynamically generate\n//           }),\n//         });\n//         const result = await response.json();\n//         if (result.success) {\n//           console.log(\n//             `NFT minted successfully with transaction hash: ${result.transactionHash}`\n//           );\n//         } else {\n//           console.error(\"Minting failed:\", result.error);\n//         }\n//       }\n//     } catch (error) {\n//       console.error(\"Error minting NFT or uploading to IPFS:\", error);\n//     } finally {\n//       setIsLoading(false); // Stop loading\n//       navigate(\"/home\"); // Navigate to home page\n//     }\n//   }\n//};\nconst uploadAndMint=async()=>{uploadToIPFS(selectedText);};const uploadToIPFS=async text=>{const url=`https://api.pinata.cloud/pinning/pinJSONToIPFS`;const data={text};try{// Start loading\nsetIsLoading(true);const response=await axios.post(url,data,{headers:{Authorization:`Bearer ${PINATA_JWT}`,// Ensure the JWT is passed correctly\n\"Content-Type\":\"application/json\"}});if(response.status===200){const ipfsHash=response.data.IpfsHash;console.log(\"Uploaded to IPFS: \",ipfsHash);// Call the minting function after uploading to IPFS\nawait mintOnServer(ipfsHash);// Stop loading\nsetIsLoading(false);return ipfsHash;// Return the content ID (CID)\n}else{console.error(\"Failed to upload to IPFS: \",response.status);setIsLoading(false);// Stop loading on error\nreturn null;}}catch(error){console.error(\"Error uploading to IPFS:\",error);setIsLoading(false);// Stop loading on error\nreturn null;}};const mintOnServer=async ipfsHash=>{try{// Start loading\nsetIsLoading(true);const response=await fetch(\"http://localhost:3000/api/mint\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userWalletAddress:process.env.REACT_APP_USER_PUBLIC_KEY,metadataURI:ipfsHash,tokenName:\"hardcoded\",tokenLabel:\"hardcoded\"})});const result=await response.json();console.log(\"Minting result:\",result);// Stop loading after the operation is complete\nsetIsLoading(false);}catch(error){console.error(\"Error minting NFT on server:\",error);setIsLoading(false);// Stop loading on error\n}};return/*#__PURE__*/_jsxs(Box,{p:6,width:theme.views.expandedView.width,height:theme.views.expandedView.height,mx:\"auto\",display:\"flex\",flexDirection:\"column\",alignItems:\"center\",gap:6,children:[/*#__PURE__*/_jsx(Text,{fontSize:\"2xl\",fontWeight:\"bold\",children:\"Highlight text to register it as IP\"}),/*#__PURE__*/_jsx(Image,{src:\"/images/register-ip.png\"// Replace with the actual image path\n,alt:\"Register IP\",maxW:\"100%\",mb:4}),/*#__PURE__*/_jsx(Text,{fontSize:\"md\",textAlign:\"left\",width:\"100%\",children:\"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio. Praesent libero. Sed cursus ante dapibus diam. Sed nisi. Nulla quis sem at nibh elementum imperdiet. Duis sagittis ipsum. Praesent mauris. Fusce nec tellus sed augue semper porta. Mauris massa. Vestibulum lacinia arcu eget nulla. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos.\"}),/*#__PURE__*/_jsx(Button,{bg:buttonEnabled?\"blue.500\":\"gray.400\",color:\"white\",_hover:buttonEnabled?{bg:\"blue.600\"}:{},disabled:!buttonEnabled// Disable button if no text is selected\n,width:\"100%\",onClick:uploadAndMint,children:\"Mint Selected Text\"})]});};export default Register;","map":{"version":3,"names":["React","useState","useEffect","Box","Text","Image","Button","useNavigate","useLoading","theme","axios","jsx","_jsx","jsxs","_jsxs","Register","selectedText","setSelectedText","buttonEnabled","setButtonEnabled","setIsLoading","navigate","PINATA_JWT","process","env","REACT_APP_PINATA_JWT","handleTextSelection","_window$getSelection","window","getSelection","toString","length","document","addEventListener","removeEventListener","uploadAndMint","uploadToIPFS","text","url","data","response","post","headers","Authorization","status","ipfsHash","IpfsHash","console","log","mintOnServer","error","fetch","method","body","JSON","stringify","userWalletAddress","REACT_APP_USER_PUBLIC_KEY","metadataURI","tokenName","tokenLabel","result","json","p","width","views","expandedView","height","mx","display","flexDirection","alignItems","gap","children","fontSize","fontWeight","src","alt","maxW","mb","textAlign","bg","color","_hover","disabled","onClick"],"sources":["/Users/emmanasseri/Desktop/my-own-words/client/src/pages/Register.tsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Box, Text, Image, Button } from \"@chakra-ui/react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useLoading } from \"../contexts/LoadingContext\";\n//import { useWallet } from \"../contexts/WalletContext\"; // Use wallet context for minting\nimport theme from \"../theme\";\nimport axios from \"axios\";\n\nconst Register: React.FC = () => {\n  const [selectedText, setSelectedText] = useState(\"\"); // State to track selected text\n  const [buttonEnabled, setButtonEnabled] = useState(false); // State to track button enable/disable\n  const { setIsLoading } = useLoading(); // Hook to trigger loading\n  // const { mintNFT } = useWallet(); // Get the mintNFT function from WalletContext\n  const navigate = useNavigate(); // Hook for navigation\n\n  const PINATA_JWT = process.env.REACT_APP_PINATA_JWT;\n\n  // Function to handle text selection in the browser\n  const handleTextSelection = () => {\n    const selectedText = window.getSelection()?.toString() || \"\";\n    setSelectedText(selectedText);\n    setButtonEnabled(selectedText.length > 0); // Enable button if text is selected\n  };\n\n  // Listen for text selection in the window\n  useEffect(() => {\n    document.addEventListener(\"mouseup\", handleTextSelection);\n\n    // Cleanup event listener when component unmounts\n    return () => {\n      document.removeEventListener(\"mouseup\", handleTextSelection);\n    };\n  }, []);\n\n  // const handleMint = async () => {\n  //   if (selectedText) {\n  //     setIsLoading(true); // Start loading\n\n  //     try {\n  //       // Step 1: Upload the selected text to IPFS\n  //       const contentID = await uploadToIPFS(selectedText);\n\n  //       if (contentID) {\n  //         console.log(\"IPFS content ID:\", contentID);\n\n  //         // Step 2: Send a request to your server's minting endpoint\n  //         const response = await fetch(\"http://localhost:3000/api/mint\", {\n  //           method: \"POST\",\n  //           headers: {\n  //             \"Content-Type\": \"application/json\",\n  //           },\n  //           body: JSON.stringify({\n  //             userWalletAddress: process.env.REACT_APP_USER_PUBLIC_KEY, // Replace with recipient wallet address\n  //             metadataURI: contentID, // Use the contentID from IPFS\n  //             tokenName: \"YourTokenName\", // Hardcode or dynamically generate\n  //             tokenLabel: \"YourTokenLabel\", // Hardcode or dynamically generate\n  //           }),\n  //         });\n\n  //         const result = await response.json();\n  //         if (result.success) {\n  //           console.log(\n  //             `NFT minted successfully with transaction hash: ${result.transactionHash}`\n  //           );\n  //         } else {\n  //           console.error(\"Minting failed:\", result.error);\n  //         }\n  //       }\n  //     } catch (error) {\n  //       console.error(\"Error minting NFT or uploading to IPFS:\", error);\n  //     } finally {\n  //       setIsLoading(false); // Stop loading\n  //       navigate(\"/home\"); // Navigate to home page\n  //     }\n  //   }\n  //};\n\n  const uploadAndMint = async () => {\n    uploadToIPFS(selectedText);\n  };\n  const uploadToIPFS = async (text: string): Promise<string | null> => {\n    const url = `https://api.pinata.cloud/pinning/pinJSONToIPFS`;\n    const data = { text };\n\n    try {\n      // Start loading\n      setIsLoading(true);\n\n      const response = await axios.post(url, data, {\n        headers: {\n          Authorization: `Bearer ${PINATA_JWT}`, // Ensure the JWT is passed correctly\n          \"Content-Type\": \"application/json\",\n        },\n      });\n\n      if (response.status === 200) {\n        const ipfsHash = response.data.IpfsHash;\n        console.log(\"Uploaded to IPFS: \", ipfsHash);\n\n        // Call the minting function after uploading to IPFS\n        await mintOnServer(ipfsHash);\n\n        // Stop loading\n        setIsLoading(false);\n\n        return ipfsHash; // Return the content ID (CID)\n      } else {\n        console.error(\"Failed to upload to IPFS: \", response.status);\n        setIsLoading(false); // Stop loading on error\n        return null;\n      }\n    } catch (error) {\n      console.error(\"Error uploading to IPFS:\", error);\n      setIsLoading(false); // Stop loading on error\n      return null;\n    }\n  };\n\n  const mintOnServer = async (ipfsHash: string) => {\n    try {\n      // Start loading\n      setIsLoading(true);\n\n      const response = await fetch(\"http://localhost:3000/api/mint\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          userWalletAddress: process.env.REACT_APP_USER_PUBLIC_KEY,\n          metadataURI: ipfsHash,\n          tokenName: \"hardcoded\",\n          tokenLabel: \"hardcoded\",\n        }),\n      });\n\n      const result = await response.json();\n      console.log(\"Minting result:\", result);\n\n      // Stop loading after the operation is complete\n      setIsLoading(false);\n    } catch (error) {\n      console.error(\"Error minting NFT on server:\", error);\n      setIsLoading(false); // Stop loading on error\n    }\n  };\n\n  return (\n    <Box\n      p={6}\n      width={theme.views.expandedView.width}\n      height={theme.views.expandedView.height}\n      mx=\"auto\"\n      display=\"flex\"\n      flexDirection=\"column\"\n      alignItems=\"center\"\n      gap={6}\n    >\n      {/* Heading */}\n      <Text fontSize=\"2xl\" fontWeight=\"bold\">\n        Highlight text to register it as IP\n      </Text>\n\n      {/* Image */}\n      <Image\n        src=\"/images/register-ip.png\" // Replace with the actual image path\n        alt=\"Register IP\"\n        maxW=\"100%\"\n        mb={4}\n      />\n\n      {/* Block of text to highlight */}\n      <Text fontSize=\"md\" textAlign=\"left\" width=\"100%\">\n        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec\n        odio. Praesent libero. Sed cursus ante dapibus diam. Sed nisi. Nulla\n        quis sem at nibh elementum imperdiet. Duis sagittis ipsum. Praesent\n        mauris. Fusce nec tellus sed augue semper porta. Mauris massa.\n        Vestibulum lacinia arcu eget nulla. Class aptent taciti sociosqu ad\n        litora torquent per conubia nostra, per inceptos himenaeos.\n      </Text>\n\n      {/* Mint button (grayed out until text is selected) */}\n      <Button\n        bg={buttonEnabled ? \"blue.500\" : \"gray.400\"}\n        color=\"white\"\n        _hover={buttonEnabled ? { bg: \"blue.600\" } : {}}\n        disabled={!buttonEnabled} // Disable button if no text is selected\n        width=\"100%\"\n        onClick={uploadAndMint}\n      >\n        Mint Selected Text\n      </Button>\n    </Box>\n  );\n};\n\nexport default Register;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}